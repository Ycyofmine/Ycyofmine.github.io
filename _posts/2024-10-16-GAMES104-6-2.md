---
title: GAMES104 06.æ¸¸æˆä¸­åœ°å½¢å¤§æ°”å’Œäº‘çš„æ¸²æŸ“(ä¸‹)
date: 2024-10-16 20:22:45 +0800
categories: [ç¬”è®°, GAMES104]
tags: [games104] # TAG names should always be lowercase
media_subpath: /assets/img/GAMES104
---

# å¤§æ°”æ•£å°„ç†è®º
## Analytic Atmosphere Appearance Modeling
å…¬å¼æœ‰ä¸¤ä¸ªå‚æ•°ï¼šå‘ä¸Šçœ‹çš„æ–¹å‘ä¸å¤©é¡¶çš„å¤¹è§’Î¸ï¼Œå‘ä¸Šçœ‹çš„æ–¹å‘ä¸å¤ªé˜³çš„å¤¹è§’Î³

ä¼˜ç‚¹ï¼šè®¡ç®—ç®€å•é«˜æ•ˆ

ç¼ºç‚¹ï¼šå±€é™äºåœ°é¢è§†è§’ï¼Œä¸èƒ½æ¨¡æ‹Ÿä»ç©ºä¸­çœ‹ã€å‚æ•°ä¸èƒ½è‡ªç”±ä¿®æ”¹

![](QQ20241016-202739.png)

## Participating Media
ä¹Ÿå°±æ˜¯ç©ºæ°”ä¸­çš„æ°”æº¶èƒ¶ã€‚

å…‰çº¿ä¸ `Participating Media` çš„äº¤äº’åŒ…æ‹¬
- `Absorption` å¸æ”¶
- `Out-scattering` æ•£å°„
- `Emission` å‘å…‰
- `In-scattering` é™„è¿‘çš„ `Participating Media` çš„ `Out-scattering` å¯¹æ‰“åˆ°è‡ªå·±
  
## Volume Rendering Equation(VRE)
![](QQ20241016-211418.png)
## Scattering Types
### Rayleigh Scattering(ç‘åˆ©æ•£å°„)
å¯¹äºè¶ŠçŸ­çš„æ³¢é•¿ï¼ˆè“å…‰ã€ç´«å…‰ï¼‰æ•£å°„å¾—è¶Šå‰å®³ï¼Œé•¿æ³¢é•¿ï¼ˆçº¢å…‰ï¼‰æ•£å°„å¾ˆå°‘ã€‚

Î»æ˜¯æ³¢é•¿ï¼ŒÎ¸æ˜¯å…‰çº¿å’Œä»‹è´¨çš„å¤¹è§’ï¼Œhæ˜¯æµ·æ‹”é«˜åº¦ï¼ˆç”¨æ¥è¡¨ç¤ºç©ºæ°”å¯†åº¦ï¼‰

å¤§å¤šç”¨äºè®¡ç®—å¤©ç©ºé¢œè‰²

![](QQ20241016-213338.png)

### Mie Scattering
- æœ‰æ–¹å‘æ€§ï¼Œæ²¿ç€å…‰çš„æ–¹å‘ä¼šç•¥å¼ºï¼Œä¸è€ƒè™‘æ³¢é•¿çš„å½±å“
- Mieæ•£å°„ä¸€èˆ¬è¡¨ç°é›¾å’Œå…‰æ™•

![å…¬å¼æœ‰é—®é¢˜ï¼Œè¯·æ³¨æ„](QQ20241016-215337.png)

# å®æ—¶å¤§æ°”æ¸²æŸ“
## Ray Marching
ç°å®ä¸­æ°”ä½“æ•£å°„ä¼šå½±å“åœºæ™¯ä¸­çš„å…‰ç…§ï¼Œä¸Šå›¾ä¸­å±±çš„èƒŒé¢è¢«ç©ºæ°”çš„æ•£å°„ç…§äº®ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Ray Matching` çš„æ–¹å¼å¤„ç†ã€‚

`Ray Marching` ä¸»è¦è®¡ç®—çš„å†…å®¹åŒ…æ‹¬å…‰çº¿æ²¿è·¯å¾„çš„è·ç¦»ã€ä¸ç‰©ä½“çš„äº¤ç‚¹ã€ä½“ç§¯å¯†åº¦ã€å…‰çº¿çš„æ•£å°„å’Œé®è”½ç­‰

![](QQ20241016-222236.png)

- æ²¿ç€å°„çº¿ï¼Œåœ¨å›ºå®šæ­¥é•¿ä¸‹ï¼Œä¸€æ­¥ä¸€æ­¥åœ°ç§¯åˆ†èµ·æ¥ã€‚
- è®¡ç®—å¤æ‚ï¼Œé‚£ä¹ˆå°±ç©ºé—´æ¢æ—¶é—´ï¼Œé¢„å…ˆè®¡ç®—ï¼Œå­˜åœ¨è¡¨ä¸­ã€‚
### Precomputed Atmospheric Scattering(é‡è¦)
å¤§æ°”æ¨¡æ‹Ÿä¸»è¦çœ‹ä¸¤ä¸ªå‚æ•°ï¼štransmittanceé€šé€åº¦ã€scatteringæ•£å°„

- å­˜ åœ¨åœ°çƒä¸Šçš„ä»»æ„ä¸€ä¸ªç‚¹ï¼Œè§†çº¿ä¸å¤©é¡¶çš„å¤¹è§’
- å­˜ ç°åœ¨æ‰€åœ¨çš„æµ·æ‹”é«˜åº¦
- transmittance LUTå­˜çš„å°±æ˜¯ä»è¿™ä¹ˆä¸€ä¸ªç‚¹çœ‹å‘è¿™ä¸ªÎ¸æ–¹å‘ï¼Œç›´åˆ°å¤§æ°”å±‚çš„è¾¹ç•Œå¤„ï¼Œè¿™äº›å¤§æ°”çš„é€šé€åº¦
- scatteringæ•£å°„è¦ç”¨ä¸‰ä¸ªè§’åº¦ç®—

ç¼ºç‚¹ï¼š
- multi-scatteringå¾ˆè´µ

- æ‰‹æœºç«¯ä¸å¥½ç”Ÿæˆtransmittance LUT

- ä¸å¥½ç”ŸæˆåŠ¨æ€çš„åˆ‡æ¢æ•ˆæœï¼Œæ™´å¤©å˜é›¨å¤©

![](https://s11.ax1x.com/2024/01/08/pFppkm4.jpg)

### Production Friendly Quick Sky and Atmosphere Rendering
[å¥½æ–‡](https://zhuanlan.zhihu.com/p/150963038)

å…ˆå¤§èƒ†å‡è®¾ï¼Œæ•£å°„åœ¨å„é¡¹åˆ†å¸ƒæ˜¯åŒæ ·çš„ã€‚

> è¿™äº›å…‰å…¥å°„åˆ°ä½ çš„ç‚¹ä¸Šï¼Œå†æ•£å°„å›æ¥çš„è¯ï¼Œå°±æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”çš„è¡°å‡

ï¼ˆæ²¡å¬æ‡‚å–µï¼‰

![](QQ20241018-105846.png)

# äº‘çš„æ¸²æŸ“
## Volmentric Cloud Modeling
- ä¼˜ç‚¹ï¼šå…¨åŠ¨æ€ã€å½¢çŠ¶å¤šå˜ã€å¯ä»¥é£˜

- ç¼ºç‚¹ï¼šæ•ˆç‡ä½ï¼Œè¿ç®—æ˜‚è´µ

- Weather Textureï¼šéšæœºçš„äº‘çš„åˆ†å¸ƒ+äº‘çš„åšåº¦

- Noise Functions

  - Perlin Noiseï¼šç”¨ä¸€ä¸ªå¤šé¡¹å¼çš„æ—¶é—´

  - Worley Noise

## Cloud Desity Model
![](https://s11.ax1x.com/2024/01/09/pFpyQxg.jpg)

## Ray Marching
åˆæ˜¯ä»–ğŸ˜‹

- ä»å±å¹•å°„å‡ºä¸€æ¡ray

- åœ¨hitåˆ°cloudä¹‹å‰ä½¿ç”¨big step

- hitåˆ°cloudä¹‹ååœ¨äº‘é‡Œé¢ä½¿ç”¨dense step(å°ä¸€ç‚¹çš„æ­¥é•¿)

- è®¡ç®—ä»å¤ªé˜³æ•£å°„åˆ°äº‘çš„radiance






# tips:
è¯„è®ºåŒºçœ‹åˆ°çš„å¤§æ°”å¯†åº¦æ‹Ÿåˆå¼
åœ°çƒçš„å¤§æ°”å±‚å¯†åº¦æ˜¯éšç€é«˜åº¦å¤§è‡´å‘ˆæŒ‡æ•°ä¸‹é™çš„, æœBarometric Densityå¯ä»¥å¾—åˆ°æ¯”è¾ƒç²¾ç¡®çš„æ‹Ÿåˆå¼. è¿™é‡Œè´´ä¸Šæˆ‘ä¸ @himisa
 åˆ¶ä½œçš„æå‡GPUè¿ç®—æ€§èƒ½çš„æ‹Ÿåˆå¼:
```cpp
float ApproxEarthDensity(float altitude)
{
    const float c0 = +2.452059275959612e-01;
    const float c1 = -1.021307723720660e-04;
    const float c2 = -6.682324198067511e-09;
    const float c3 = +1.421577941465463e-13;
    const float c4 = -1.006813818672577e-18;
    return exp2(c0 + altitude * (c1 + altitude * (c2 + altitude * (c3 + altitude * c4))));
}
```